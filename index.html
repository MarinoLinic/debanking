<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Debanking Tracker</title>

		<!-- Favicon -->
		<link rel="icon" type="image/x-icon" href="favicon.ico" />

		<!-- Social Media / Open Graph -->
		<meta property="og:title" content="Debanking Tracker" />
		<meta
			property="og:description"
			content="Monitoring the weaponization of the banking system and providing alternatives."
		/>
		<meta property="og:image" content="image.jpg" />
		<meta property="og:type" content="website" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:image" content="image.jpg" />

		<style>
			:root {
				/* Light Mode Variables */
				--bg-color: #f3f4f6; /* Light Gray Background */
				--card-bg: #ffffff; /* White Cards */
				--text-main: #1f2937; /* Dark Gray Text */
				--text-muted: #6b7280; /* Muted Text */
				--border: #e5e7eb; /* Light Borders */

				--accent-red: #dc2626;
				--accent-red-bg: #fef2f2;
				--accent-green: #059669;
				--accent-green-bg: #ecfdf5;
				--accent-blue: #2563eb;
				--accent-blue-bg: #eff6ff;

				--font-stack: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
			}

			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}
			html {
				scroll-behavior: smooth;
			}

			body {
				background-color: var(--bg-color);
				color: var(--text-main);
				font-family: var(--font-stack);
				line-height: 1.6;
				padding-bottom: 80px; /* Space for footer */
				position: relative;
				min-height: 100vh;
			}

			/* --- Header & Quote --- */
			header {
				max-width: 900px;
				margin: 0 auto;
				padding: 60px 20px 40px;
				text-align: center;
			}

			/* Toggle Button Styles */
			.quote-toggle-wrapper {
				display: flex;
				justify-content: flex-end; /* Align to right side of quote area */
				margin-bottom: 10px;
			}

			.toggle-btn {
				background: transparent;
				border: none;
				color: var(--text-muted);
				font-size: 0.85rem;
				cursor: pointer;
				display: flex;
				align-items: center;
				gap: 5px;
				padding: 0;
				transition: color 0.2s;
			}

			.toggle-btn:hover {
				color: var(--accent-blue);
				text-decoration: underline;
			}

			.quote-container {
				background: linear-gradient(180deg, rgba(220, 38, 38, 0.05) 0%, rgba(255, 255, 255, 0) 100%);
				border-left: 4px solid var(--accent-red);
				/* Increased padding-left/right to 80px to stop text overlapping arrows */
				padding: 30px 80px;
				margin-bottom: 40px;
				border-radius: 0 8px 8px 0;
				text-align: left;
				position: relative;
				background-color: white;
				box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
				transition: all 0.3s ease-in-out;
				min-height: 140px; /* Prevent jumpiness */
				opacity: 1;
				overflow: hidden;
			}

			.quote-container.hidden {
				max-height: 0;
				min-height: 0;
				opacity: 0;
				margin-bottom: 20px;
				padding-top: 0;
				padding-bottom: 0;
				border-left-width: 0;
				pointer-events: none;
			}

			/* Carousel Specifics */
			.carousel-wrapper {
				position: relative;
				width: 100%;
				height: 100%;
			}

			.quote-slide {
				display: none;
				animation: fadeEffect 0.6s;
			}

			.quote-slide.active {
				display: block;
			}

			@keyframes fadeEffect {
				from {
					opacity: 0;
				}
				to {
					opacity: 1;
				}
			}

			.quote-text {
				font-size: 1.1rem;
				font-style: italic;
				color: var(--text-main);
				margin-bottom: 15px;
			}

			.quote-source {
				font-size: 0.9rem;
				color: var(--text-muted);
				text-align: right;
				display: block;
				text-decoration: none;
				font-weight: 500;
			}

			.quote-source:hover {
				text-decoration: underline;
				color: var(--accent-red);
			}

			/* Carousel Nav Buttons */
			.carousel-btn {
				position: absolute;
				top: 50%;
				transform: translateY(-50%);
				background: none;
				border: none;
				color: #9ca3af; /* Lighter gray by default */
				font-size: 1.8rem; /* Slightly larger */
				cursor: pointer;
				padding: 10px;
				transition: all 0.2s;
				z-index: 10;
				display: flex;
				align-items: center;
				justify-content: center;
				border-radius: 50%;
			}
			.carousel-btn:hover {
				color: var(--accent-red);
				background-color: rgba(0, 0, 0, 0.03);
			}
			/* Moved slightly closer to edge (0px) since padding is large enough now */
			.carousel-btn.prev {
				left: -70px;
			}
			.carousel-btn.next {
				right: -70px;
			}

			h1 {
				font-size: 2.5rem;
				font-weight: 800;
				letter-spacing: -1px;
				margin-bottom: 10px;
				color: #111827;
			}
			.subtitle {
				color: var(--text-muted);
				margin-bottom: 30px;
				font-weight: 500;
				max-width: 700px;
				margin-left: auto;
				margin-right: auto;
			}

			/* --- Navigation Tabs --- */
			.tabs {
				display: flex;
				justify-content: center;
				gap: 15px;
				margin-bottom: 30px;
			}

			.tab-btn {
				background: white;
				border: 1px solid var(--border);
				color: var(--text-muted);
				padding: 10px 24px;
				border-radius: 50px;
				cursor: pointer;
				font-weight: 600;
				transition: all 0.2s ease;
				box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
			}

			.tab-btn.active {
				background: var(--text-main);
				color: white;
				border-color: var(--text-main);
			}

			.tab-btn:hover:not(.active) {
				border-color: var(--text-muted);
				color: var(--text-main);
			}

			/* --- Filters & Search --- */
			.controls-area {
				max-width: 1200px;
				margin: 0 auto 30px;
				padding: 0 20px;
				display: flex;
				flex-wrap: wrap;
				gap: 15px;
				align-items: flex-start;
				justify-content: space-between;
			}

			.left-controls {
				display: flex;
				flex-direction: column;
				gap: 10px;
				flex: 1;
				min-width: 200px;
			}

			.results-count {
				font-size: 0.95rem;
				font-weight: 600;
				color: var(--text-muted);
			}

			.active-filters {
				display: flex;
				gap: 10px;
				flex-wrap: wrap;
				min-height: 32px;
			}

			.filter-group {
				display: flex;
				gap: 10px;
				margin-left: auto;
				flex-wrap: wrap;
			}

			.filter-badge {
				background-color: var(--accent-blue);
				color: white;
				padding: 6px 14px;
				border-radius: 6px;
				font-size: 0.85rem;
				display: flex;
				align-items: center;
				gap: 8px;
				animation: fadeIn 0.3s ease;
				box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
			}

			.filter-badge button {
				background: none;
				border: none;
				color: white;
				cursor: pointer;
				font-weight: bold;
				opacity: 0.8;
			}
			.filter-badge button:hover {
				opacity: 1;
			}

			.clear-btn {
				background: none;
				border: none;
				color: var(--accent-red);
				font-size: 0.9rem;
				cursor: pointer;
				text-decoration: underline;
				display: none;
				font-weight: 500;
			}

			/* Generic Dropdown Style */
			select.custom-select {
				background: white;
				color: var(--text-main);
				border: 1px solid var(--border);
				padding: 8px 12px;
				border-radius: 8px;
				min-width: 150px;
				font-family: inherit;
				font-size: 0.9rem;
				cursor: pointer;
				box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
			}
			select.custom-select:hover {
				border-color: #9ca3af;
			}

			/* Search Input */
			.search-input {
				background: white;
				color: var(--text-main);
				border: 1px solid var(--border);
				padding: 8px 12px;
				border-radius: 8px;
				min-width: 200px;
				font-family: inherit;
				font-size: 0.9rem;
				box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
			}
			.search-input:focus {
				outline: 2px solid var(--accent-blue);
				border-color: transparent;
			}

			/* --- Grid Layout --- */
			.grid-container {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
				gap: 24px;
				max-width: 1200px;
				margin: 0 auto;
				padding: 0 20px;
			}

			/* --- Cards --- */
			.card {
				background-color: var(--card-bg);
				border: 1px solid var(--border);
				border-radius: 12px;
				padding: 24px;
				transition: all 0.2s ease;
				display: flex;
				flex-direction: column;
				position: relative;
				overflow: hidden;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
			}

			.card:hover {
				transform: translateY(-2px);
				box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
				border-color: #d1d5db;
			}

			/* Top Right Ribbon Badge */
			.status-badge {
				position: absolute;
				top: 18px;
				right: -32px;
				transform: rotate(45deg);
				width: 120px;
				text-align: center;
				font-size: 0.65rem;
				font-weight: 800;
				padding: 4px 0;
				text-transform: uppercase;
				letter-spacing: 1px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
				z-index: 2;
			}
			.status-badge.red {
				background-color: #fee2e2; /* Very light red */
				color: #991b1b; /* Dark red */
				border-bottom: 1px solid rgba(220, 38, 38, 0.1);
			}

			.card-top-row {
				display: flex;
				gap: 15px;
				margin-bottom: 15px;
				align-items: flex-start;
				padding-right: 40px; /* Space for the top-right badge */
			}

			/* Icons & Logos */
			.icon-wrapper {
				width: 48px;
				height: 48px;
				flex-shrink: 0;
				position: relative;
				border-radius: 10px;
				overflow: hidden;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
				display: block;
			}

			.entity-icon {
				width: 100%;
				height: 100%;
				background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
				color: var(--text-muted);
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: 700;
				font-size: 1.1rem;
				border: 1px solid var(--border);
			}

			.entity-img {
				width: 100%;
				height: 100%;
				object-fit: contain;
				background: white;
				padding: 4px;
				border: 1px solid var(--border);
				display: block;
			}

			.entity-info {
				flex-grow: 1;
			}

			.entity-name {
				font-size: 1.25rem;
				font-weight: 700;
				color: #111827;
				line-height: 1.2;
				margin-bottom: 4px;
			}

			.entity-name a {
				color: inherit;
				text-decoration: none;
				transition: color 0.2s ease;
			}
			.entity-name a:hover {
				color: var(--accent-blue);
			}

			.year-badge {
				display: inline-block;
				font-size: 0.75rem;
				color: var(--text-muted);
				margin-top: 2px;
				background: #f3f4f6;
				padding: 2px 8px;
				border-radius: 4px;
			}
			.year-badge.recent {
				color: var(--accent-red);
				background: var(--accent-red-bg);
				font-weight: 600;
			}

			/* Meta Tags (Type vs Country) */
			.meta-tags {
				display: flex;
				gap: 8px;
				margin-bottom: 16px;
				flex-wrap: wrap;
			}

			.tag {
				font-size: 0.75rem;
				padding: 4px 10px;
				border-radius: 6px;
				cursor: pointer;
				font-weight: 600;
				transition: opacity 0.2s;
				display: flex;
				align-items: center;
				gap: 6px;
			}
			.tag:hover {
				opacity: 0.8;
			}

			.tag-type {
				background-color: var(--accent-blue-bg);
				color: var(--accent-blue);
				border: 1px solid rgba(37, 99, 235, 0.1);
			}

			.tag-country {
				background-color: white;
				color: var(--text-main);
				border: 1px solid var(--border);
			}

			.flag-img {
				height: 12px;
				width: auto;
				border-radius: 2px;
				box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
			}

			.description {
				font-size: 0.95rem;
				color: #4b5563;
				margin-bottom: 20px;
				flex-grow: 1;
			}

			.people-section {
				border-top: 1px solid var(--border);
				padding-top: 15px;
				margin-top: auto;
			}

			.people-label {
				font-size: 0.7rem;
				color: var(--text-muted);
				margin-bottom: 8px;
				text-transform: uppercase;
				letter-spacing: 0.5px;
				font-weight: 700;
			}

			.people-tags {
				display: flex;
				flex-wrap: wrap;
				gap: 6px;
			}

			/* Person Tag with Action Button Support */
			.person-tag {
				font-size: 0.8rem;
				background: #f3f4f6;
				color: var(--text-main);
				padding: 4px 6px 4px 12px; /* Left padding for text, right for button */
				border-radius: 20px;
				cursor: pointer;
				transition: all 0.2s;
				border: 1px solid var(--border);
				font-weight: 500;
				display: inline-flex;
				align-items: center;
				gap: 6px;
				height: 30px; /* Fixed height for consistency */
			}

			.person-tag:hover {
				background: white;
				border-color: var(--accent-red);
				color: var(--accent-red);
			}

			/* New Minimalist Source Button */
			.source-link {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				background-color: white;
				color: var(--text-muted);
				border: 1px solid var(--border);
				border-radius: 50%;
				width: 22px;
				height: 22px;
				flex-shrink: 0;
				transition: all 0.2s ease;
			}

			.source-link:hover {
				background-color: var(--accent-blue);
				color: white;
				border-color: var(--accent-blue);
				transform: scale(1.1);
			}

			.source-link svg {
				width: 11px;
				height: 11px;
				stroke-width: 2.5;
			}

			/* Alternatives Specifics */
			.verification-badge {
				display: inline-block;
				font-size: 0.75rem;
				padding: 4px 10px;
				border-radius: 6px;
				margin-top: 10px;
				font-weight: 600;
			}

			.status-verified {
				background: var(--accent-green-bg);
				color: var(--accent-green);
				border: 1px solid rgba(5, 150, 105, 0.1);
			}
			.status-unverified {
				background: #fffbeb;
				color: #d97706;
				border: 1px solid rgba(217, 119, 6, 0.1);
			}
			.status-neutral {
				background: #f3f4f6;
				color: var(--text-muted);
				border: 1px solid var(--border);
			}

			.alt-link {
				display: block;
				margin-top: 15px;
				color: var(--accent-green);
				text-decoration: none;
				font-weight: 600;
				font-size: 0.9rem;
			}
			.alt-link:hover {
				text-decoration: underline;
			}

			/* Footer */
			footer {
				margin-top: 50px;
				padding: 30px;
				text-align: center;
				font-size: 0.9rem;
				color: var(--text-muted);
				border-top: 1px solid var(--border);
				background: white;
			}
			footer a {
				color: var(--text-main);
				text-decoration: none;
				font-weight: 600;
				margin: 0 5px;
			}
			footer a:hover {
				color: var(--accent-blue);
				text-decoration: underline;
			}

			/* Floating Scroll Buttons */
			.scroll-controls {
				position: fixed;
				bottom: 30px;
				right: 30px;
				display: flex;
				flex-direction: column;
				gap: 10px;
				z-index: 100;
			}

			.scroll-btn {
				width: 45px;
				height: 45px;
				background: var(--text-main);
				color: white;
				border: none;
				border-radius: 50%;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 1.2rem;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
				transition: all 0.2s;
				opacity: 0.7;
			}

			.scroll-btn:hover {
				opacity: 1;
				transform: translateY(-2px);
				background: var(--accent-blue);
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(5px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			/* Mobile Optimizations */
			@media (max-width: 768px) {
				.grid-container {
					grid-template-columns: 1fr;
				}
				h1 {
					font-size: 1.8rem;
				}

				.quote-container {
					/* Increased mobile padding as well to safely clear arrows */
					padding: 20px 40px;
					border-left-width: 3px;
				}
				.quote-text {
					font-size: 0.9rem;
					line-height: 1.4;
					margin-bottom: 10px;
				}
				.quote-source {
					font-size: 0.8rem;
				}
				.quote-toggle-wrapper {
					margin-bottom: 5px;
				}

				.carousel-btn {
					padding: 5px;
					font-size: 1.2rem;
				}
				/* Ensure arrows stick to very edge on mobile to maximize text space */
				.carousel-btn.prev {
					left: -35px;
				}
				.carousel-btn.next {
					right: -35px;
				}

				.controls-area {
					flex-direction: column;
					align-items: stretch;
					gap: 15px;
				}
				.left-controls {
					width: 100%;
				}
				.filter-group {
					flex-direction: column;
					width: 100%;
					margin-left: 0;
					gap: 10px;
				}
				select.custom-select,
				.search-input {
					width: 100%;
				}
				.scroll-controls {
					bottom: 20px;
					right: 20px;
				}
				.scroll-btn {
					width: 40px;
					height: 40px;
				}
			}
		</style>
	</head>
	<body>
		<a id="top"></a>

		<header>
			<!-- Toggle Button Area -->
			<div class="quote-toggle-wrapper">
				<button id="quoteToggleBtn" class="toggle-btn" onclick="toggleQuote()">Hide Quote Context</button>
			</div>

			<!-- Collapsible Quote Carousel -->
			<div id="quoteContainer" class="quote-container" onmouseenter="pauseCarousel()" onmouseleave="resumeCarousel()">
				<div class="carousel-wrapper">
					<button class="carousel-btn prev" onclick="moveSlide(-1)">&#10094;</button>
					<div id="quoteSlides">
						<!-- Slides injected via JS -->
					</div>
					<button class="carousel-btn next" onclick="moveSlide(1)">&#10095;</button>
				</div>
			</div>

			<h1>Debanking Tracker</h1>
			<p class="subtitle">
				Monitoring the weaponization of the banking system against the Right. Sources are available through the icon
				next to the target's name.
			</p>

			<div class="tabs">
				<button class="tab-btn active" onclick="switchTab('debanking')">Debanking List</button>
				<button class="tab-btn" onclick="switchTab('alternatives')">Alternatives</button>
			</div>
		</header>

		<!-- Filter Controls -->
		<div class="controls-area">
			<div class="left-controls">
				<div id="resultsCount" class="results-count">Loading...</div>
				<div class="active-filters" id="activeFilters">
					<!-- Filter badges injected here -->
				</div>
			</div>

			<div class="filter-group">
				<input
					type="text"
					id="searchInput"
					class="search-input"
					placeholder="Search names, people, desc..."
					oninput="handleSearch(this.value)"
				/>
				<select id="countrySelect" class="custom-select" onchange="addFilter('country', this.value)">
					<option value="">All Countries</option>
				</select>
				<select id="typeSelect" class="custom-select" onchange="addFilter('type', this.value)">
					<option value="">All Types</option>
				</select>
				<select id="personSelect" class="custom-select" onchange="addFilter('person', this.value)">
					<option value="">All People</option>
				</select>
				<button id="clearBtn" class="clear-btn" onclick="clearAllFilters()">Clear Filters</button>
			</div>
		</div>

		<!-- Main Content Grid -->
		<div id="grid" class="grid-container">
			<div style="color: var(--text-muted); text-align: center; grid-column: 1/-1; padding: 50px">
				Loading data...<br />
				<small>Note: If viewing locally, ensure you are running a local server (CORS).</small>
			</div>
		</div>

		<!-- Footer -->
		<footer>
			Created by <strong>Marino Linich</strong> &bull; <a href="https://x.com/MarinoLinic" target="_blank">X</a> &bull;
			<a href="https://github.com/MarinoLinic/debanking" target="_blank">GitHub Repo</a> &bull;
			<a href="https://marinolinich.substack.com/" target="_blank">Substack</a>
		</footer>

		<!-- Floating Scroll Controls -->
		<div class="scroll-controls">
			<button class="scroll-btn" onclick="window.scrollTo(0,0)" title="Scroll to Top">↑</button>
			<button class="scroll-btn" onclick="window.scrollTo(0, document.body.scrollHeight)" title="Scroll to Bottom">
				↓
			</button>
		</div>

		<script>
			// --- Quote Carousel Logic ---
			const quotes = [
				{
					text: 'Debanking for political speech is clearly a human rights issue, but it has never, not once, been tried as such by the entire human rights NGO world.',
					author: 'Erik Haalo (X)',
					url: 'https://x.com/Erik_Hamre/status/1998674420680823064',
				},
				{
					text: "You literally can't get a bank account. You can't get a visa terminal. You can't process transactions. You can't do payroll. You can't do direct deposit. You can't get insurance. You've been sanctioned. And then [the Biden] administration extended that concept to apply to tech founders, crypto founders, and political opponents.",
					author: 'Marc Andreessen on Operation Chokepoint 2.0',
					url: 'https://x.com/BasedTorba/status/1861786736315019752',
				},
			]

			let slideIndex = 0
			let carouselTimer

			function initCarousel() {
				const container = document.getElementById('quoteSlides')
				container.innerHTML = quotes
					.map(
						(q, index) => `
					<div class="quote-slide ${index === 0 ? 'active' : ''}">
						<div class="quote-text"><p>${q.text}</p></div>
						<a href="${q.url}" target="_blank" class="quote-source">— ${q.author}</a>
					</div>
				`
					)
					.join('')
				startCarousel()
			}

			function showSlide(n) {
				const slides = document.getElementsByClassName('quote-slide')
				if (n >= slides.length) slideIndex = 0
				if (n < 0) slideIndex = slides.length - 1

				for (let i = 0; i < slides.length; i++) {
					slides[i].classList.remove('active')
				}
				slides[slideIndex].classList.add('active')
			}

			function moveSlide(n) {
				showSlide((slideIndex += n))
			}

			function startCarousel() {
				carouselTimer = setInterval(() => {
					moveSlide(1)
				}, 1000000) // 1000 seconds
			}

			function pauseCarousel() {
				clearInterval(carouselTimer)
			}

			function resumeCarousel() {
				startCarousel()
			}

			// Toggle Quote Visibility
			function toggleQuote() {
				const container = document.getElementById('quoteContainer')
				const btn = document.getElementById('quoteToggleBtn')

				// Toggle the class
				container.classList.toggle('hidden')

				// Update button text
				if (container.classList.contains('hidden')) {
					btn.innerText = 'Show Quote Context'
				} else {
					btn.innerText = 'Hide Quote Context'
				}
			}

			// --- Main Data Logic ---

			// State
			let debankingData = []
			let alternativesData = []
			let sourcesMap = {} // Maps "Entity|Person" -> URL
			let globalSources = {} // Maps "Person" -> URL (for wildcards)
			let currentTab = 'debanking' // 'debanking' or 'alternatives'

			let filters = {
				person: null,
				type: null,
				country: null,
				search: null,
			}

			// Initialize
			document.addEventListener('DOMContentLoaded', () => {
				initCarousel() // Start the quote carousel

				Promise.all([
					fetch('debanking.json').then((res) => res.json()),
					fetch('debanking_alternatives.json').then((res) => res.json()),
					fetch('sources.json').then((res) => res.json()),
				])
					.then(([debanking, alternatives, sources]) => {
						// Process Sources
						sources.forEach((src) => {
							if (src.entity === '*') {
								globalSources[src.person] = src.url
							} else {
								// Create composite key
								sourcesMap[`${src.entity}|${src.person}`] = src.url
							}
						})

						// Order debanking by number of people affected (Descending)
						debankingData = debanking.sort((a, b) => {
							const countA = a.people ? a.people.length : 0
							const countB = b.people ? b.people.length : 0
							return countB - countA
						})

						alternativesData = alternatives
						populateDropdowns()
						render()
					})
					.catch((err) => {
						console.error(err)
						document.getElementById(
							'grid'
						).innerHTML = `<div style="text-align:center; color: var(--accent-red); grid-column: 1/-1;">
                        Error loading data. Please ensure JSON files are present and you are using a local server (CORS).
                    </div>`
					})
			})

			// Helper: Generate Monogram from Name
			function getMonogram(name) {
				if (!name) return '?'
				const parts = name.split(' ')
				if (parts.length > 1) {
					return (parts[0][0] + parts[1][0]).toUpperCase()
				}
				return name.substring(0, 2).toUpperCase()
			}

			// Helper: Get Flag IMG from FlagCDN
			function getFlagHtml(country) {
				if (!country) return `<img src="https://flagcdn.com/w40/un.png" class="flag-img" alt="Global">`

				const cleanName = country.split('/')[0].trim().toLowerCase()
				const isoMap = {
					austria: 'at',
					australia: 'au',
					germany: 'de',
					greece: 'gr',
					croatia: 'hr',
					usa: 'us',
					uk: 'gb',
					slovakia: 'sk',
					hungary: 'hu',
					poland: 'pl',
					'czech republic': 'cz',
					france: 'fr',
					russia: 'ru',
					switzerland: 'ch',
					turkey: 'tr',
					malta: 'mt',
					netherlands: 'nl',
					lithuania: 'lt',
					luxembourg: 'lu',
					finland: 'fi',
					gibraltar: 'gi',
					ireland: 'ie',
					singapore: 'sg',
					bvi: 'vg',
					'hong kong': 'hk',
					uae: 'ae',
					canada: 'ca',
					romania: 'ro',
					spain: 'es',
					iceland: 'is',
					europe: 'eu',
					global: 'un',
					ukraine: 'ua',
					estonia: 'ee',
					latvia: 'lv',
					sweden: 'se',
					uae: 'ae',
				}

				const code = isoMap[cleanName]
				return code
					? `<img src="https://flagcdn.com/w40/${code}.png" class="flag-img" alt="${country}">`
					: `<img src="https://flagcdn.com/w40/un.png" class="flag-img" alt="Global">`
			}

			// Helper: Unified Icon Renderer
			function renderIconHtml(item) {
				const monogram = getMonogram(item.name)
				let content
				if (item.url) {
					content = `
                    <img src="https://www.google.com/s2/favicons?domain=${item.url}&sz=64" 
                         class="entity-img" 
                         alt="${item.name}"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    <div class="entity-icon" style="display:none">${monogram}</div>
                `
				} else {
					content = `<div class="entity-icon">${monogram}</div>`
				}

				if (item.url) {
					return `<a href="${item.url}" target="_blank" class="icon-wrapper" title="Go to ${item.name}">${content}</a>`
				} else {
					return `<div class="icon-wrapper">${content}</div>`
				}
			}

			// Helper: Populate Dropdowns
			function populateDropdowns() {
				const countrySet = new Set()
				const typeSet = new Set()
				const personSet = new Set()

				;[...debankingData, ...alternativesData].forEach((item) => {
					if (item.name && item.name.startsWith('None identified')) return

					if (item.type) typeSet.add(item.type)
					if (item.country) {
						const parts = item.country.split('/')
						parts.forEach((p) => countrySet.add(p.trim()))
					}
				})

				debankingData.forEach((item) => {
					if (item.people && Array.isArray(item.people)) {
						item.people.forEach((p) => personSet.add(p))
					}
				})

				const countrySelect = document.getElementById('countrySelect')
				const typeSelect = document.getElementById('typeSelect')
				const personSelect = document.getElementById('personSelect')

				Array.from(countrySet)
					.sort()
					.forEach((c) => countrySelect.appendChild(createOption(c)))
				Array.from(typeSet)
					.sort()
					.forEach((t) => typeSelect.appendChild(createOption(t)))
				Array.from(personSet)
					.sort()
					.forEach((p) => personSelect.appendChild(createOption(p)))
			}

			function createOption(val) {
				const opt = document.createElement('option')
				opt.value = val
				opt.innerText = val
				return opt
			}

			// Navigation & Filtering
			function switchTab(tab) {
				currentTab = tab
				document.querySelectorAll('.tab-btn').forEach((btn) => {
					btn.classList.toggle(
						'active',
						btn.innerText.toLowerCase().includes(tab === 'debanking' ? 'debanking' : 'alternatives')
					)
				})
				// Keep filters/search active when switching? Usually better to clear or keep.
				// For now we clear to avoid confusion.
				clearAllFilters()
			}

			function addFilter(key, value) {
				if (!value) return
				filters[key] = value
				// Sync UI
				if (key === 'country') document.getElementById('countrySelect').value = value
				if (key === 'type') document.getElementById('typeSelect').value = value
				if (key === 'person') document.getElementById('personSelect').value = value
				render()
			}

			function removeFilter(key) {
				filters[key] = null
				if (key === 'country') document.getElementById('countrySelect').value = ''
				if (key === 'type') document.getElementById('typeSelect').value = ''
				if (key === 'person') document.getElementById('personSelect').value = ''
				render()
			}

			function handleSearch(val) {
				filters.search = val ? val.toLowerCase() : null
				render()
			}

			function clearAllFilters() {
				filters = { person: null, type: null, country: null, search: null }
				document.getElementById('countrySelect').value = ''
				document.getElementById('typeSelect').value = ''
				document.getElementById('personSelect').value = ''
				document.getElementById('searchInput').value = ''
				render()
			}

			// Rendering
			function render() {
				const grid = document.getElementById('grid')
				const filterContainer = document.getElementById('activeFilters')
				const clearBtn = document.getElementById('clearBtn')
				const resultsCount = document.getElementById('resultsCount')

				grid.innerHTML = ''
				filterContainer.innerHTML = ''

				let hasFilters = false

				// Render badges for dropdown filters
				const dropdownKeys = ['person', 'type', 'country']
				dropdownKeys.forEach((key) => {
					if (filters[key]) {
						hasFilters = true
						const badge = document.createElement('div')
						badge.className = 'filter-badge'
						let label = key === 'person' ? 'Target' : key.charAt(0).toUpperCase() + key.slice(1)
						badge.innerHTML = `<span>${label}: ${filters[key]}</span> <button onclick="removeFilter('${key}')">×</button>`
						filterContainer.appendChild(badge)
					}
				})

				if (filters.search) hasFilters = true

				clearBtn.style.display = hasFilters ? 'block' : 'none'

				const sourceData = currentTab === 'debanking' ? debankingData : alternativesData

				const filteredData = sourceData.filter((item) => {
					if (item.name && item.name.startsWith('None identified')) return false

					// Dropdown Logic
					if (filters.country && (!item.country || !item.country.includes(filters.country))) return false
					if (filters.type && item.type !== filters.type) return false
					if (filters.person && (!item.people || !item.people.includes(filters.person))) return false

					// Search Logic
					if (filters.search) {
						const s = filters.search
						const matchName = item.name?.toLowerCase().includes(s)
						const matchDesc = item.description?.toLowerCase().includes(s)
						const matchPeople = item.people?.some((p) => p.toLowerCase().includes(s))
						const matchCountry = item.country?.toLowerCase().includes(s)

						if (!matchName && !matchDesc && !matchPeople && !matchCountry) return false
					}

					return true
				})

				// Update results count
				resultsCount.innerText = `Showing ${filteredData.length} ${filteredData.length === 1 ? 'item' : 'items'}`

				if (filteredData.length === 0) {
					grid.innerHTML = `<div style="text-align:center; color: var(--text-muted); grid-column: 1/-1; padding-top: 40px;">No results found for these filters.</div>`
					return
				}

				filteredData.forEach((item) => {
					const card = document.createElement('div')
					card.className = 'card'
					if (currentTab === 'debanking') {
						renderDebankingCard(card, item)
					} else {
						renderAlternativeCard(card, item)
					}
					grid.appendChild(card)
				})
			}

			function renderDebankingCard(card, item) {
				const isRecent = item.year_last && item.year_last >= 2023
				const flagHtml = getFlagHtml(item.country)
				const iconHtml = renderIconHtml(item)

				let peopleHtml = ''
				if (item.people && item.people.length > 0) {
					peopleHtml = `
                <div class="people-section">
                    <span class="people-label">Targeted (${item.people.length}):</span>
                    <div class="people-tags">
                        ${item.people
													.map((p) => {
														// Look for specific source first, then wildcard source
														const sourceUrl = sourcesMap[`${item.name}|${p}`] || globalSources[p]
														const linkHtml = sourceUrl
															? `<a href="${sourceUrl}" target="_blank" class="source-link" title="View Source for ${p} @ ${item.name}" onclick="event.stopPropagation();">
																<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
																	<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
																	<polyline points="15 3 21 3 21 9"></polyline>
																	<line x1="10" y1="14" x2="21" y2="3"></line>
																</svg>
															   </a>`
															: ''
														return `<span class="person-tag" onclick="addFilter('person', '${p}')">${p}${linkHtml}</span>`
													})
													.join('')}
                    </div>
                </div>`
				}

				card.innerHTML = `
				<div class="status-badge red">Debanked</div>
                <div class="card-top-row">
                    ${iconHtml}
                    <div class="entity-info">
                        <div class="entity-name">
							${item.url ? `<a href="${item.url}" target="_blank">${item.name}</a>` : item.name}
						</div>
                        ${
													item.year_last
														? `<span class="year-badge ${isRecent ? 'recent' : ''}">Last Incident: ${
																item.year_last
														  }</span>`
														: ''
												}
                    </div>
                </div>
                
                <div class="meta-tags">
                    <span class="tag tag-type" onclick="addFilter('type', '${item.type}')">${item.type}</span>
                    <span class="tag tag-country" onclick="addFilter('country', '${item.country}')">${flagHtml} ${
					item.country
				}</span>
                </div>

                <div class="description">${item.description}</div>
                ${peopleHtml}
            `
			}

			function renderAlternativeCard(card, item) {
				const flagHtml = getFlagHtml(item.country)
				const iconHtml = renderIconHtml(item)

				let statusClass = 'status-neutral'
				if (
					item.verification_status?.toLowerCase().includes('technical guarantee') ||
					item.verification_status?.toLowerCase().includes('proven track record') ||
					item.verification_status?.toLowerCase().includes('reliable')
				) {
					statusClass = 'status-verified'
				} else if (item.verification_status?.toLowerCase().includes('unverified')) {
					statusClass = 'status-unverified'
				}

				card.innerHTML = `
                 <div class="card-top-row">
                    ${iconHtml}
                    <div class="entity-info">
                        <div class="entity-name">
							${item.url ? `<a href="${item.url}" target="_blank">${item.name}</a>` : item.name}
						</div>
                    </div>
                </div>

                <div class="meta-tags">
                    <span class="tag tag-type" onclick="addFilter('type', '${item.type}')">${item.type}</span>
                    ${
											item.country
												? `<span class="tag tag-country" onclick="addFilter('country', '${item.country}')">${flagHtml} ${item.country}</span>`
												: ''
										}
                </div>

                <div class="description">${item.description}</div>
                
                <div style="margin-top:auto">
                    ${
											item.verification_status
												? `<span class="verification-badge ${statusClass}">${item.verification_status}</span>`
												: ''
										}
                    ${item.url ? `<a href="${item.url}" target="_blank" class="alt-link">Visit Website &rarr;</a>` : ''}
                </div>
            `
			}
		</script>
	</body>
</html>
